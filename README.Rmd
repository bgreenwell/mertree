# mertree

[![Build Status](https://travis-ci.org/bgreenwell/mertree.svg?branch=master)](https://travis-ci.org/bgreenwell/mertree)
[![Coverage Status](https://img.shields.io/codecov/c/github/bgreenwell/mertree.svg)](https://codecov.io/github/bgreenwell/mertree?branch=master)

`mertree` (mixed-effects regression trees) is an alternative implementation of [`REEMtree`](http://pages.stern.nyu.edu/~jsimonof/REEMtree/) and [`REEMctree`](http://people.stern.nyu.edu/jsimonof/unbiasedREEM/) that uses [`lme4`](https://cran.r-project.org/web/packages/lme4/index.html) for efficient computation of mixed-effects models with large data sets.

## Installation
Package `mertree` is not currently available from CRAN, but the development version is hosted on GitHub at https://github.com/bgreenwell/mertree and can be downloaded using [`devtools`](https://github.com/hadley/devtools):
```r
# Assuming devtools is already installed
devtools::install_github("bgreenwell/mertree")
```
Bug reports should be submitted to https://github.com/bgreenwell/mertree/issues.

## Basic usage

```{r, warning=FALSE}
# Required packages
library(ggplot2)
library(mertree)

# mertree
fm <- mertree(y ~ time + x1 + x2 + x3 + x4 + x5 + x6 + (1 | subject), 
              data = simd,      # simulated data (included with package)
              unbiased = TRUE,  # use a conditional inference tree
              do.trace = TRUE)  # print trace information

# Tree diagram
plot(fm)

# Univariate partial dependence plot for time: should be linear
pd_time <- partial_1d(fm, x.name = "time")
ggplot(pd_time, aes(time, y)) +
  geom_line() +
  theme_light() +
  xlab("Time") +
  ylab("Partial dependence")

# Bivariate partial dependence plot for x2 and x4
pd_24 <- partial_2d(fm, x1.name = "x2", x2.name = "x4", n1 = 15, n2 = 15, 
                    .progress = "text")
lattice::wireframe(y ~ x2*x4, data = pd_24)
```

## References

Rebecca J. Sela and Jeffrey S. Simonoff (2012). "RE-EM Trees: A Data Mining Approach for Longitudinal and Clustered Data". _Machine Learning_, 86(2), 169-207.

Wei Fu and Jeffrey S. Simonoff (2015), "Unbiased Regression Trees for Longitudinal and Clustered Data". _Computational Statistics and Data Analysis_, 88, 53-74.

Douglas Bates, Martin Maechler, Ben Bolker, Steve Walker (2015). "Fitting Linear Mixed-Effects Models Using lme4". _Journal of Statistical Software_, 67(1), 53-74. doi:10.18637/jss.v067.i01.


